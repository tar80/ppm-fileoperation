Array.prototype.includes||(Array.prototype.includes=function(e,t){if(null==this)throw new TypeError('Array.includes: "this" is null or not defined');var r=Object(this),n=r.length>>>0;if(0===n)return!1;var a=null!=t?t:0,i=Math.max(a>=0?a:n-Math.abs(a),0);function sameValueZero(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}for(;i<n;){if(sameValueZero(r[i],e))return!0;i++}return!1});var e=PPx.CreateObject("Scripting.FileSystemObject"),isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},isEmptyStr=function(e){return""===e},r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},writeLines=function(n){var a=n.path,i=n.data,u=n.enc,c=void 0===u?"utf8":u,o=n.append,s=void 0!==o&&o,p=n.overwrite,l=void 0!==p&&p,d=n.linefeed,f=void 0===d?t.nlcode:d;if(!l&&!s&&e.FileExists(a))return[!0,a+" already exists"];var x,P=e.GetParentFolderName(a);if(e.FolderExists(P)||PPx.Execute("*makedir "+P),"utf8"===c){if(isCV8()){var m=i.join(f),v=s?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[v](a,m)]}var h=l||s?2:1,E=PPx.CreateObject("ADODB.Stream");x=exec(E,(function(){E.Open(),E.Charset="UTF-8",E.LineSeparator=Number(r.Ascii[f]),s?(E.LoadFromFile(a),E.Position=E.Size,E.SetEOS):E.Position=0,E.WriteText(i.join(f),1),E.SaveToFile(a,h)}))[0]}else{var y=s?8:l?2:1;e.FileExists(a)||PPx.Execute("%Osq *makefile "+a);var b="utf16le"===c?-1:0,S=e.GetFile(a).OpenAsTextStream(y,b);x=exec(S,(function(){S.Write(i.join(f)+f)}))[0]}return x?[!0,"Could not write to "+a]:[!1,""]},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=r.replace(/^.*\\/,""),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},n={en:{abort:"Abort. Not supported",fileExpand:"Specify path (archive file extraction)",createLink:"Specify path (create symbolic link)",notSupported:function(e){return"Operation to "+e+" is not supported"}},ja:{abort:"非対応ディレクトリ",fileExpand:"パスを指定 (書庫ファイル展開)",createLink:"パスを指定 (シンボリックリンク作成)",notSupported:function(e){return e+"への処理は非対応です"}}},a="ppm-fileoperation",i=t.nlcode,u=useLanguage();pathSelf();var _dialog=function(e,t){return 0===PPx.Execute('%"'+a+'" %OC %'+e+'"'+t+'"')},_hasTargetId=function(e){return"."!==e},c={echo:function(e,t){var r=t?"("+String(t)+")":"";return _dialog("I",""+e+r)},question:function(e){return _dialog("Q",e)},execute:function(e,t,r){return void 0===r&&(r=!1),isEmptyStr(t)?1:_hasTargetId(e)?r?Number(PPx.Extract("%*extract("+e+',"'+t+'%%:0")')):PPx.Execute("*execute "+e+","+t):PPx.Execute(t)},extract:function(e,t){if(isEmptyStr(t))return[13,""];var r=_hasTargetId(e)?PPx.Extract("%*extract("+e+',"'+t+'")'):PPx.Extract(t);return[Number(PPx.Extract()),r]}},o="PPXUNDO.LOG",s="utf16le",undologPath=function(){var e=PPx.Extract("%*getcust(X_save)%\\"+o);return~e.indexOf(":")||(e=PPx.Extract("%0%\\")+e),PPx.Execute('%OC *execute ,*ifmatch "o:e,a:d-","'+e+'"%%:*stop%bn*makefile "'+e+'"%%&'),e},undologWrite=function(e){writeLines({path:undologPath(),data:e,enc:s,linefeed:i,overwrite:!0})},pairsExtract=function(e,t){var r=t?e+"('"+t.replace(/\\/g,"\\\\")+"')":e;return c.extract("~",'%%*js(""PPx.result=PPx.'+r+';"")')},_getAttribute=function(e){switch(e){case 1:case 3:return"DIR";case 4:return"LISTFILE";case 5:case 6:case 7:case 8:case 10:case 21:return"SPECIAL";case 63:case 64:case 96:return"ARCHIVE";default:return"NA"}},fileOperation=function(e,t,r,n,a){var i=PPx.Entry,u=Math.max(PPx.EntryMarkCount,1),c={success:0,skip:0,error:0,pass:0,undoData:[]};i.FirstMark;do{c=t(r,n,i.Name,a.dir,c)}while(i.NextMark);return c.success>0&&undologWrite(c.undoData),PPx.linemessage(resultMsg(e,u,c)),0===c.error&&"NA"!==a.dirtype},datetime=function(){var e=PPx.Extract("%*getcust(S_ppm#user:fo_datetime)");return isEmptyStr(e)?"":PPx.Extract('%bt%*nowdatetime("'+e+'")')},resultMsg=function(e,t,r){var n=r.success,a=r.skip,i=r.error,u=r.pass,c=e+"\t"+n+"/"+t,o=[];return a>0&&o.push("Skip:"+a),i>0&&o.push("Error:"+i),u>0&&o.push("Pass:"+u),o.length>0&&(c=c+" ["+o.join(",")+"]"),""+c+datetime()},p={parentDetails:function(e,t){return{send:{dir:e,dirtype:_getAttribute(PPx.DirectoryType)},dest:{dir:t,dirtype:_getAttribute(Number(pairsExtract("DirectoryType")[1]))}}},cmdParameters:function(e,t,r){var n="-same:"+r+" "+PPx.Extract("%*getcust(S_ppm#user:fo_options)"),a="NA"!==e.dirtype;return a?(t&&(n="-start -min "+n),{destPath:e.dir,opts:n,compcmd:"",ok:a}):isEmptyStr(e.dir)?{destPath:"%*getcust(S_ppm#user:work)%\\",opts:n,compcmd:' -compcmd *ppc -pane:~ "%%hd0" -k *jumppath -entry:"%%R"',ok:a}:void 0},switchMethod:function(e,t,r,n){return void 0===n&&(n=!1),0!==e&&(/LISTFILE|SPECIAL/.test(t.dirtype+r.dirtype)||n&&t.dir.slice(0,1).toUpperCase()!==r.dir.slice(0,1).toUpperCase())&&(e=0),e},ppcfile:function(e,t){var r=isEmptyStr(t.compcmd)?t.opts:""+t.opts+t.compcmd;return c.execute("C","*ppcfile "+e+","+t.destPath+",%("+r+"%)"),t.ok},expandFiles:function(e){c.execute("C",'*unpack "'+e+'"')},fileOperation:fileOperation,performMove:function(t,r,n,a,u){var c=u.success,o=u.skip,s=u.error,p=u.pass,l=u.undoData,d=r+"\\"+n,f=a+"\\"+n,x=":DIR"===PPx.GetFileInformation(n)?"Folder":"File";if(!e[x+"Exists"](d))return{success:c,skip:o,error:s,pass:++p,undoData:l};var P={message:n};if(e[x+"Exists"](f))o++,P.header="Skip";else try{e["Move"+x](d,f),l.push("Move\t"+d+i+" ->\t"+f),c++,P.header="Move"}catch(m){s++,P.header=m,PPx.EntryState=0}return t&&PPx.linemessage(P.header+"\t"+P.message),{success:c,skip:o,error:s,pass:p,undoData:l}},updateWindow:function(e){return e?PPx.Execute('*execute C,%%K"@F5"'):PPx.Execute('*execute C,*unmarkentry path:%%:%%K"@^F5"')},updatePairWindow:function(){return PPx.Execute('*ifmatch C*,%~n%:%K~"@^F5"')}},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return isNaN(r)?e:r;case"boolean":return"false"!==t&&"0"!==t&&null!=t;default:return t}},l=n[u],main=function(){var e=safeArgs(!1,0,!1,!1,!1,"3"),t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],u=e[5],c=pathDetails(i),o=c.send,s=c.dest,d=p.switchMethod(r,o,s,!0);if("ARCHIVE"!==o.dirtype&&"ARCHIVE"!==s.dirtype)if(0===d){var f=p.cmdParameters(s,t,u);if(!f)return void PPx.linemessage('!"'+l.abort);p.ppcfile("move",f)}else{p.fileOperation("MoveFS",p.performMove,n,o.dir,s)&&(p.updateWindow(a),!i&&p.updatePairWindow())}else PPx.linemessage('!"'+l.abort)},pathDetails=function(e){var t=c.extract("C","%%1")[1],r=e?c.extract(".",'%*name(DN,"'+t+'")'):c.extract("C","%%2"),n=(r[0],r[1]);return p.parentDetails(t,n)};main();
