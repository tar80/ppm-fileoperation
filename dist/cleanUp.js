var e=PPx.CreateObject("Scripting.FileSystemObject");Array.prototype.includes||(Array.prototype.includes=function(e,t){if(null==this)throw new TypeError('Array.includes: "this" is null or not defined');var n=Object(this),r=n.length>>>0;if(0===r)return!1;var a=null!=t?t:0,u=Math.max(a>=0?a:r-Math.abs(a),0);function sameValueZero(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}for(;u<r;){if(sameValueZero(n[u],e))return!0;u++}return!1});var t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},isEmptyStr=function(e){return""===e},pathSelf=function(){var e,t,n=PPx.ScriptName;return~n.indexOf("\\")?(e=n.replace(/^.*\\/,""),t=PPx.Extract("%*name(DKN,"+n+")")):(e=n,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},n={en:{notExistList:"cleanup.txt does not exist",question:"Start clenup",complete:"Completed",remaining:"There are files that failed to cleanup",test:"**Test Execution**\nPaths below are subject to deletion\n"},ja:{notExistList:"cleanup.txtがありません",question:"不要ファイルを消去します",complete:"完了",remaining:"消去に失敗したファイルがあります",test:"**テスト実行**\n以下のパスが消去対象です\n"}},r="ppm-fileoperation",a=t.nlcode,u=useLanguage();pathSelf();var _dialog=function(e,t){return 0===PPx.Execute('%"'+r+'" %OC %'+e+'"'+t+'"')},_hasTargetId=function(e){return"."!==e},i={echo:function(e,t){var n=t?"("+String(t)+")":"";return _dialog("I",""+e+n)},question:function(e){return _dialog("Q",e)},execute:function(e,t,n){return void 0===n&&(n=!1),isEmptyStr(t)?1:_hasTargetId(e)?n?Number(PPx.Extract("%*extract("+e+',"'+t+'%%:0")')):PPx.Execute("*execute "+e+","+t):PPx.Execute(t)},extract:function(e,t){if(isEmptyStr(t))return[13,""];var n=_hasTargetId(e)?PPx.Extract("%*extract("+e+',"'+t+'")'):PPx.Extract(t);return[Number(PPx.Extract()),n]}},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),n=0,r=arguments.length;n<r;n++)e.push(_valueConverter(n<0||arguments.length<=n?undefined:arguments[n],t[n]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var n=Number(t);return isNaN(n)?e:n;case"boolean":return"false"!==t&&"0"!==t&&null!=t;default:return t}},c=n[u],main=function(){var t=safeArgs(!1)[0],n=PPx.Extract("%sgu'ppmcache'\\list\\cleanup.txt");if(e.FileExists(n)){var r=PPx.Extract("%OC %*extract(\"%*insertSource(%sgu'ppmcache'\\list\\cleanup.txt)\")").replace(/;/g,",").split(","),u=[],o=[],l=o[0],s=o[1];t||!i.question(c.question)&&PPx.Quit(-1);for(var p=0;p<r.length;p++){var x=r[p];if(!isEmptyStr(x)){if(t)return void i.echo(c.test+a+r.join(a));l=cleanupFiles(x),s=cleanupFolders(x),l||s||u.push(x)}}0===u.length?PPx.linemessage('!"'+c.complete):(c.remaining,u.join(a))}else i.echo(c.notExistList)},cleanupFiles=function(t){var n=!0;try{e.DeleteFile(t,!0)}catch(r){n=!1}return n},cleanupFolders=function(t){var n=!0;try{e.DeleteFolder(t,!0)}catch(r){n=!1}return n};main();
